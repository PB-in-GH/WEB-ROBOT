<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <title>LiteAvatar WebRTC</title>
</head>
<body>
  <h3>LiteAvatar WebRTC Receiver</h3>
  <video id="v" autoplay playsinline controls></video>

  <script>
    async function start() {
      const pc = new RTCPeerConnection({
        iceServers: [{ urls: ["stun:stun.l.google.com:19302"] }]
      });

      pc.ontrack = (evt) => {
        const video = document.getElementById("v");
        if (video.srcObject !== evt.streams[0]) {
          video.srcObject = evt.streams[0];
        }
      };

      // 只收视频（recvonly）
      pc.addTransceiver("video", { direction: "recvonly" });
      pc.addTransceiver("audio", { direction: "recvonly" });

      const offer = await pc.createOffer();
      await pc.setLocalDescription(offer);

      const resp = await fetch("/offer", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ sdp: pc.localDescription.sdp, type: pc.localDescription.type })
      });

      const answer = await resp.json();
      await pc.setRemoteDescription(answer);
    }

    start().catch(console.error);
  </script>
</body>
</html>
